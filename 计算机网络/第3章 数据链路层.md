# 数据链路层的三个基本问题

### 1.封装成帧

#### 1.1 问题本质

数据链路层接收网络层的分组后，需要将其包装成**帧**（数据链路层的传输单元）才能在链路上传输。但分组本身没有明确的边界，接收方无法区分 “哪里是一个帧的开始，哪里是结束”，容易导致帧丢失或错误拼接。

#### 1.2 解决必要性

如果不封装成帧，接收方会把连续传输的比特流混为一谈，无法正确提取一个完整的分组，直接导致数据传输混乱。

#### 1.3 具体解决方法

在分组的**前后添加帧定界符**，用特殊的比特组合标记帧的起始和结束，常用两种方式：

- **字符计数法**：在帧头部添加一个字段，记录帧的数据部分的字符数。接收方根据该数字确定帧的边界。缺点是计数字段一旦出错，后续所有帧都会同步错误。
- **字符填充法**：适用于**面向字符的链路**（传输 ASCII 码字符）。定义特殊字符作为帧起始符（SOH）和帧结束符（EOT）。若数据部分包含与定界符相同的字符，则在其前面添加转义字符（ESC），接收方收到转义字符后，就知道后面的字符是数据而非定界符。
- **零比特填充法**：适用于**面向比特的链路**（如以太网）。定义 **01111110** 作为帧的首尾定界符。发送方在数据部分的比特流中，每遇到**5 个连续的 “1”**，就自动插入 1 个 “0”；接收方收到后，每检测到**5 个连续的 “1”**，就自动删除后面的 “0”，恢复原始数据。

### 2.透明传输

#### 2.1 问题本质

“透明传输” 指**数据链路层对传输的数据内容不加限制**，数据中可以包含任意比特组合（包括与帧定界符相同的比特序列），且这些内容不会被链路层误解为控制信息。如果不处理，当数据中出现与定界符相同的比特流时，接收方会误判为帧的边界，导致帧被错误截断。

#### 2.2 解决必要性

透明传输是保障数据完整性的关键 —— 如果链路层限制数据内容，就无法传输包含特殊比特组合的文件（如二进制文件、压缩包），失去了通用传输能力。

#### 2.3 具体解决方法

透明传输的解决方法**与封装成帧的方法绑定**，本质是通过 “填充” 消除数据中的定界符歧义：

- 面向字符链路：用**字符填充法**（添加转义字符 ESC）。

- 面向比特链路：用

  零比特填充法

  （插入 “0” 比特）。

  

  这两种方法能让数据中的特殊字符 / 比特流 “被透明传输”，接收方可以正确还原，不会误判为控制信息。

### 3.差错检测

#### 3.1 问题本质

物理层传输的比特流容易受到电磁干扰、信号衰减等影响，导致比特位发生翻转（0 变 1 或 1 变 0），这种错误称为**传输差错**。接收方需要能检测出这些错误的帧。

#### 3.2 解决必要性

如果不检测差错，错误的数据会被传输到上层，可能导致应用程序出错、文件损坏等严重问题。差错检测是保障数据传输可靠性的第一道防线。

#### 3.3 具体解决方法

数据链路层通过**循环冗余检验（CRC）** 实现差错检测，步骤如下：

### 局域网按网络拓扑进行分类

1. 总线型
2. 星型
3. 环型
4. 树型
5. 网状

# 网络适配器

又称**网卡**，**计算机与外界局域网**的连接通过适配器，工作在**数据链路层和物理层**

### 网络适配器的核心作用

1. **串行 / 并行转换**

   计算机内部的数据传输是**并行传输**（如主板总线同时传输多个比特），而网络链路中的数据传输是**串行传输**（比特流逐位传输）。网卡负责完成两种传输方式的转换，实现计算机与网络的物理数据交互。

2. **数据缓存**

   网卡内置缓存芯片，可临时存储待发送或刚接收的数据。这一功能能缓解计算机 CPU 与网络传输速率不匹配的问题，避免数据丢失或传输阻塞。

3. **驱动程序适配**

   网卡需要在操作系统中安装对应的**设备驱动程序**，驱动程序是网卡与操作系统之间的通信桥梁，能让操作系统识别网卡、配置网络参数（如 IP 地址、子网掩码），并调用网卡的硬件功能。

4. **实现以太网协议**

   网卡是数据链路层协议（如以太网协议）的**硬件载体**，负责完成帧的封装与解封装（添加 / 剥离帧头帧尾）、MAC 地址寻址、CRC 差错检测等数据链路层核心操作。

# CSMA/CD协议(IEEE802.3以太网采用的介质访问控制协议)要点

### 1.多点接入

**先听后发**，就是说明这是总线型网络，许多计算机以多点接入的方式连接在一根总线上。协议的实质是**“载波监听”和“碰撞检测”**

### 2.载波监听

**边发送边监听**，不管在发送数据之前还是发送数据之中，每个站都必须不停地检测信道

### 3.碰撞检测

**冲突停止**，适配器边发送数据边检测信道上的信号电压的变化情况，当适配器检测到的信号电压变化幅度超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞，适配器要立即停止发送。



显然，在使用CSMA/CD协议时，一个站不可能同时进行发送和接收（但必须边发送边监听信道），因此使用CSMA/CD协议的以太网不可能进行全双工通信，只能进行**半双工通信**

### 延迟重发

以太网的端到端往返时间2t称为**争用期**，又称碰撞窗口，经过争用期这段时间还没检测到碰撞才能肯定这次发送不会发送碰撞

使用**截断二进制指数退避算法**来确定重传时机

`k=min(10,重传次数)`

从`[0,1,2,..,2^k-1]`中随机取一个数记为r，重传应推后的时间是r倍的争用期

发送的最短帧长为64字节，如果发送数据非常少，必须进行字节填充，接收方凡是接收到长度小于6

4字节的帧都是由于冲突而异常中止的无效帧，应该立即丢弃

### 强化碰撞

为了让所有用户都知道现在已经发送了碰撞，还要继续发送32比特或48比特的人为干扰信号





### MAC地址

MAC地址是固化在适配器的ROM中的48位地址



# 扩展的以太网

### 在物理层扩展以太网

集线器

从表面上看，使用集线器的局域网在物理上是星形网，但逻辑上仍是总现网，各站共享逻辑上的总线，使用的还是CSMA/CD协议。

有许多端口，很像一个多端口的转发器

工作在物理层，他的端口仅仅简单地转发比特，不进行碰撞检测

- 所有端口**共享同一带宽**，同一时间只能有一台设备发送数据，极易产生数据冲突，导致网络效率低下。
- 不能将不同的以太网技术进行互连（如数据率不同），一个端口使用10Mbit/s的适配器，而另外两个使用10/100Mbit/s，那么用集线器连接起来后，大家都只能工作在10Mbit/s的速率。
- 基本上是个多端口的转发器，不能把帧进行缓存

### 在数据链路层扩展以太网

交换机

以太网交换机**只有MAC地址**，无IP地址

- 每一个端口和连接到端口的主机构成一个碰撞域

- 以太网交换机的端口还有存储器，能在输出端口繁忙时把到来的帧进行缓存
- 一般具有多种速率的端口



### 以太网交换机的自学习功能

交换表有三列：MAC地址，端口，写入时间

有时可能要在交换机的端口更换主机，或着主机要更换网络适配器，这就需要及时更改交换表中的项目，所以当交换表中写入一个项目时就记下当时的时间，只要超过预先设定的时间，该项目就自动被删除

为了解决兜圈子的问题，制定了**生成树协议**，在逻辑上切断某些链路，使路径是无环路的树状结构



# VLAN

建立虚拟局域网VLAN，把较大的局域网分割成较小的局域网，而每一个局域网是一个较小的广播域。每个端口是一个冲突域